<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Personal Puzzle Web - bé yêu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        textarea {
            width: 100%;
            height: 120px;
        }

        input[type=text] {
            width: 300px;
        }

        #art {
            white-space: pre;
            font-family: monospace;
            background: #f5f5f5;
            padding: 10px;
            margin-top: 8px;
        }

        #result {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h2>Personal Puzzle Web (bé yêu)</h2>
    <label>Input:</label><br />
    <textarea id="input"></textarea><br />
    <label>Key:</label><br />
    <input type="text" id="key" /><br /><br />
    <button id="btnSend">Gửi lên server</button>
    <div id="result" style="display:block; margin-top:20px;">
        <h3>Kết quả</h3>
        <div><strong>Encoded:</strong> <span id="encoded"></span></div>
        <h4>ASCII Art</h4>
        <div id="art"></div>
        <div><strong>Signature:</strong> <span id="signature"></span></div>
    </div>

    <script>
        function encodeFormData(data) {
            var pairs = [];
            for (var key in data) {
                pairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(data[key]));
            }
            return pairs.join('&');
        }

        document.getElementById('btnSend').onclick = function () {
            var i = document.getElementById('input').value;
            var k = document.getElementById('key').value;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'api.aspx', true);
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');

            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {
                        try {
                            var obj = JSON.parse(xhr.responseText);
                            document.getElementById('encoded').innerText = obj.encoded || '';
                            document.getElementById('art').innerText = obj.asciiArt || '';
                            document.getElementById('signature').innerText = obj.signature || '';
                        } catch (e) {
                            alert('Lỗi khi phân tích JSON: ' + e);
                        }
                    } else {
                        alert('Server trả lỗi: ' + xhr.status);
                    }
                }
            };

            var body = encodeFormData({ input: i, key: k });
            xhr.send(body);
        };
    </script>
</body>
</html>
